pipeline {
    agent any
    stages {
        stage('Getting Git') {
            steps {
                git branch: 'master', url: 'https://github.com/Harmanjeet3/Maven_Jenkins_project.git'
            }
        }
        stage('Test') {
            steps {
                echo "Test"
            }
        }
        stage('Maven Package') {
            steps {
                sh 'mvn -f Hello_app_maven/pom.xml package'
            }
        }
        stage('deployemnt') {
            steps {
                echo "End"
                sh'''
                ls /var/lib/jenkins/workspace/pipeline_job/
                sudo cp /var/lib/jenkins/workspace/pipeline_job/Hello_app_maven/target/Hello_app_maven.war /opt/webapps/
                sudo /opt/bin/startup.sh 
                
                '''
            }
        }
        stage('Git Push') {
          steps {
            
            sh '''
            pwd
            sudo cp /var/lib/jenkins/workspace/pipeline_job/Hello_app_maven/target/Hello_app_maven.war /var/lib/jenkins/workspace/new_war
            echo "Moved"
            whoami
            cd ..
            cd new_war
            pwd
            sudo mv Hello_app_maven.war Hello_war$(date +%Y%m%d%H%M%S).war
            git remote set-url origin https://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@github.com/Harmanjeet3/new_war.git
            sudo git add .
            sudo git commit -m "$(date +%Y%m%d%H%M%S) war push"
            sudo git status
            sudo git remote -v
            echo "before push"
            whoami
            git status
            
            git push origin master
            echo "after push"
           '''
          }
        }
        
        stage('Ending Process') {
            steps {
                echo "End"
            }
        }
    }
}